{% extends "base.html" %}
{% block title %}Verify Trust - ETP Filing Tracker{% endblock %}

{% block content %}
<div class="header">
  <h1>Verify Trust</h1>
  <a href="/search/" style="font-size:13px;">Back to Search</a>
</div>

{% if error %}
<div style="padding:20px; background:#f8d7da; border:1px solid #f5c6cb; border-radius:8px; color:#721c24; margin-bottom:20px;">
  {{ error }}
</div>
{% endif %}

{% if submitted %}
<div style="padding:20px; background:#d4edda; border:1px solid #c3e6cb; border-radius:8px; color:#155724; margin-bottom:20px;">
  <strong>Request submitted.</strong> Our team will review your request and add this trust to monitoring.
  You will see it on the dashboard once it has been approved and the pipeline has run.
</div>
{% endif %}

{% if details %}
<div class="detail-header">
  <h2>{{ details.name }}</h2>
</div>

<div class="meta-grid" style="margin-bottom:24px;">
  <div class="meta-item">
    <div class="meta-label">CIK</div>
    <div class="meta-value">{{ details.cik }}</div>
  </div>
  {% if details.entity_type is defined %}
  <div class="meta-item">
    <div class="meta-label">Entity Type</div>
    <div class="meta-value">{{ details.entity_type or 'N/A' }}</div>
  </div>
  {% endif %}
  {% if details.sic_description is defined or details.sic is defined %}
  <div class="meta-item">
    <div class="meta-label">SIC</div>
    <div class="meta-value">{{ details.sic_description or details.sic or 'N/A' }}</div>
  </div>
  {% endif %}
  {% if details.state is defined %}
  <div class="meta-item">
    <div class="meta-label">State</div>
    <div class="meta-value">{{ details.state or 'N/A' }}</div>
  </div>
  {% endif %}
  {% if details.filing_count is defined %}
  <div class="meta-item">
    <div class="meta-label">Recent Filings</div>
    <div class="meta-value">{{ details.filing_count }}</div>
  </div>
  {% endif %}
  {% if details.has_prospectus_filings is defined %}
  <div class="meta-item">
    <div class="meta-label">Has Prospectus Filings</div>
    <div class="meta-value">
      {% if details.has_prospectus_filings %}
        Yes ({{ details.prospectus_forms|join(', ') }})
      {% else %}
        No
      {% endif %}
    </div>
  </div>
  {% endif %}
</div>

{% if already_monitored %}
<div class="alert alert-success">
  This trust is already being monitored.
</div>
{% elif not submitted %}
<form method="post" action="/search/request" style="margin-top:16px;">
  <input type="hidden" name="cik" value="{{ details.cik }}">
  <input type="hidden" name="name" value="{{ details.name }}">
  <div class="alert alert-info">
    <p style="margin:0; font-size:14px;">
      <strong>Request monitoring for "{{ details.name }}"?</strong><br>
      <span style="color:var(--muted); font-size:13px;">
        Your request will be reviewed by our team. Once approved, the pipeline will
        fetch and process all prospectus filings for this trust.
      </span>
    </p>
  </div>
  <button type="submit" class="btn btn-primary">Request Monitoring</button>
  <a href="/search/" class="btn" style="margin-left:8px;">Cancel</a>
</form>
{% endif %}

<!-- View filings on EDGAR -->
<div class="alert alert-info" style="margin-top:20px;">
  <p style="margin:0; font-size:14px;">
    <strong>View filings on EDGAR directly</strong><br>
    <span style="color:var(--muted); font-size:13px;">
      Browse this trust's SEC filings. This data is not processed by our tracker unless you request monitoring above.
    </span>
  </p>
  <p style="margin-top:10px;">
    <a href="https://www.sec.gov/cgi-bin/browse-edgar?action=getcompany&CIK={{ '%010d' % (details.cik|int) }}&type=485&dateb=&owner=include&count=40"
       target="_blank" class="btn btn-primary btn-sm">
      View {{ details.name }} on EDGAR
    </a>
  </p>
</div>
{% endif %}
{% endblock %}
